function validaciones()
    
    close all;

    %% Variables reales del robot
    
    % Reloj
    clock = [0.900000000000000;1;1.10000000000000;1.20000000000000;1.30000000000000;1.40000000000000;1.50000000000000;1.60000000000000;1.70000000000000;1.80000000000000;1.90000000000000;2;2.10000000000000;2.20000000000000;2.30000000000000;2.40000000000000;2.50000000000000;2.60000000000000;2.70000000000000;2.80000000000000;2.90000000000000;3;3.10000000000000;3.20000000000000;3.30000000000000;3.40000000000000;3.50000000000000;3.60000000000000;3.70000000000000;3.80000000000000;3.90000000000000;4;4.10000000000000;4.20000000000000;4.30000000000000;4.40000000000000;4.50000000000000;4.60000000000000;4.70000000000000;4.80000000000000;4.90000000000000;5;5.10000000000000;5.20000000000000;5.30000000000000;5.40000000000000;5.50000000000000;5.60000000000000;5.70000000000000;5.80000000000000;5.90000000000000;6;6.10000000000000;6.20000000000000;6.30000000000000;6.40000000000000;6.50000000000000;6.60000000000000;6.70000000000000;6.80000000000000;6.90000000000000;7;7.10000000000000;7.20000000000000;7.30000000000000;7.40000000000000;7.50000000000000;7.60000000000000;7.70000000000000;7.80000000000000;7.90000000000000;8;8.10000000000000;8.20000000000000;8.30000000000000;8.40000000000000;8.50000000000000;8.60000000000000;8.70000000000000;8.80000000000000;8.90000000000000;9;9.10000000000000;9.20000000000000;9.30000000000000;9.40000000000000;9.50000000000000;9.60000000000000;9.70000000000000;9.80000000000000;9.90000000000000;10;10.1000000000000;10.2000000000000;10.3000000000000;10.4000000000000;10.5000000000000;10.6000000000000;10.7000000000000;10.8000000000000;10.9000000000000;11;11.1000000000000;11.2000000000000;11.3000000000000;11.4000000000000;11.5000000000000;11.6000000000000;11.7000000000000;11.8000000000000;11.9000000000000;12;12.1000000000000;12.2000000000000;12.3000000000000;12.4000000000000;12.5000000000000;12.6000000000000;12.7000000000000;12.8000000000000;12.9000000000000;13;13.1000000000000;13.2000000000000;13.3000000000000;13.4000000000000;13.5000000000000;13.6000000000000;13.7000000000000;13.8000000000000;13.9000000000000;14;14.1000000000000;14.2000000000000;14.3000000000000;14.4000000000000;14.5000000000000;14.6000000000000;14.7000000000000;14.8000000000000;14.9000000000000;15;15.1000000000000;15.2000000000000;15.3000000000000;15.4000000000000;15.5000000000000;15.6000000000000;15.7000000000000;15.8000000000000;15.9000000000000];
    
    % Estados medidos
    X = [3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000;3832.64000000000];
    Y = [650.454545454545;670.454545454545;690.454545454545;710.454545454545;730.454545454545;750.454545454545;770.454545454545;790.454545454545;810.454545454545;830.454545454545;850.454545454545;870.454545454545;890.454545454545;910.454545454545;930.454545454545;950.454545454545;970.454545454545;990.454545454545;1010.45454545454;1030.45454545454;1050.45454545454;1070.45454545454;1090.45454545454;1110.45454545454;1130.45454545454;1150.45454545454;1170.45454545454;1190.45454545454;1210.45454545454;1230.45454545454;1250.45454545454;1270.45454545454;1290.45454545454;1310.45454545454;1330.45454545454;1350.45454545454;1370.45454545454;1390.45454545455;1410.45454545455;1430.45454545455;1450.45454545455;1470.45454545455;1490.45454545455;1510.45454545455;1530.45454545455;1550.45454545455;1570.45454545455;1590.45454545455;1610.45454545455;1630.45454545455;1650.45454545455;1670.45454545455;1690.45454545455;1710.45454545455;1730.45454545455;1750.45454545455;1770.45454545455;1790.45454545455;1810.45454545455;1830.45454545455;1850.45454545455;1870.45454545455;1890.45454545455;1910.45454545455;1930.45454545455;1950.45454545455;1970.45454545455;1990.45454545455;2010.45454545455;2030.45454545455;2050.45454545455;2070.45454545455;2090.45454545455;2110.45454545455;2130.45454545455;2150.45454545455;2170.45454545455;2190.45454545455;2210.45454545455;2230.45454545455;2250.45454545455;2270.45454545455;2290.45454545455;2310.45454545455;2330.45454545455;2350.45454545455;2370.45454545455;2390.45454545455;2410.45454545455;2430.45454545455;2450.45454545455;2470.45454545455;2490.45454545455;2510.45454545455;2530.45454545455;2550.45454545455;2570.45454545455;2590.45454545455;2610.45454545455;2630.45454545455;2650.45454545455;2670.45454545455;2690.45454545455;2710.45454545455;2730.45454545455;2750.45454545455;2770.45454545455;2790.45454545455;2810.45454545455;2830.45454545455;2850.45454545455;2870.45454545455;2890.45454545455;2910.45454545455;2930.45454545455;2950.45454545455;2970.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455;2990.45454545455];
    theta = [0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0];
    
    % Velocidades medidas
    vl = [200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0];
    vr = [200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;200;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0];
    
    % Mediciones de infrarrojos
    medida_1 = [1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1431.93371454033;1500;1136.76516869307;1500;1500;1500;1500;1500;1500;1500;1500;1500;1350.46663467391;1500;1468.39060329639;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1384.77289050954;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1328.09333074125;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1447.00972620244;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1417.01967549790;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1373.23714114689;1500;1471.47132490898;1500;1500;1500;1500;1500;1471.47132490898;1500;1500;1500;1500;1500;1500;1490.09475811847;1500;1500;1500];
    medida_2 = [148.750677134140;146.537369147969;154.541392126223;141.035317472678;148.503200624396;143.876982466318;146.537369147969;148.503200624396;154.797175709792;155.566384500599;155.823397771250;179.879680207889;155.823397771250;186.482289661056;164.989584799558;160.498484852728;168.197249508650;170.350552471888;167.392709130823;168.734526467431;185.930789022440;197.804516727686;154.541392126223;147.517139232719;187.033957716143;202.216369241427;197.804516727686;200.011735967331;207.163481220320;215.349712754226;215.349712754226;206.340483890335;210.721344056849;217.787140851984;225.303478034399;232.441463981901;237.909146791395;233.750236879145;251.099236247151;241.766315810322;256.766819060257;253.822747030294;258.713876536196;269.904403240081;270.837755412249;279.339951721507;295.534115631172;311.959919417550;321.304812030493;321.304812030493;299.010105060259;309.802284325357;321.304812030493;312.391840358956;321.304812030493;323.063669822531;332.016731946656;330.200978979493;353.283398588562;373.394047340106;388.820858765957;356.693558765287;375.529438578250;365.480715422385;363.227617265637;384.784041910555;631.720873662723;388.820858765957;344.245504845810;378.644402134619;396.931268909097;409.112348349909;445.522964691954;426.451898505388;414.801465283063;441.523695384029;467.606603511029;534.469492518871;518.714771875399;484.343085984050;518.714771875399;518.714771875399;526.844093220813;524.600444946065;527.596450121875;555.387489763416;631.720873662723;533.696697787031;533.696697787031;550.416615305158;547.151234281476;556.224541807371;542.324982008025;588.049523782966;631.720873662723;631.720873662723;645.704497659326;832.470900910471;793.815195882943;631.720873662723;682.371565725724;518.714771875399;704.466710001466;760.416138123197;754.812135912677;818.265303626492;672.897106346322;934.109905075009;759.009547239809;770.367403121617;701.957606680889;486.221887971199;553.720758706220;793.815195882943;997.818225544399;966.286154913680;1328.09333074125;956.682445307150;987.832222649358;1201.92139967483;870.300395979156;977.966855268289;930.412455199370;901.485751531597;897.950534541932;897.950534541932;763.240545846231;905.038730685990;897.950534541932;987.832222649358;991.812087786248;997.818225544399;956.682445307150;976.008164305566;771.804121768485;956.682445307150;1148.52707699896;913.999319203341;1020.21734338728;1020.21734338728;930.412455199370;976.008164305566;858.551094782232;897.950534541932;958.593773924193;1043.21697717676;897.950534541932;903.260016737349;939.690520582740;905.038730685990;1005.89460360978];
    medida_3 = [1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500;1500];
    
    %% Parametros de la simulación
    tipo = 5;
    
    mapa = mapas(tipo);
    puntos = size(clock, 1);
    
    % Cantidad de puntos en el mapa
    [punto_Y, punto_X] = size(mapa);
    
    % Mapa a recorrer
    X_map = linspace(0, 4060, punto_X);
    Y_map = linspace(0, 5175, punto_Y);
    
    % Diferencial de tiempo
    dt = 0.1;
    
    % Separacion de memoria
    estado_ideal = zeros(3, puntos);
    estado_real = zeros(3, puntos);
    
    
    % Estado inicial
    X_init = 3832.64000000000;
    Y_init = 470.454545454545;
    estado_inicial = [X_init Y_init 0]';
    
    estado_ideal(:, 1) = estado_inicial;
    estado_real(:, 1) = estado_inicial;
    
    %% Parametros del filtro de particulas
    % Numero de particulas
    Np = 5000;
    
    w_k = repmat(1/Np, 1, Np);
    estado_filtrado = zeros(3, puntos);
    particulas = mvnrnd(estado_inicial,diag([100 100 0.5]), Np)';
    
    estado_filtrado(:, 1) = estado_inicial;
    
    robot.mapa = mapa;
    robot.X_map = X_map;
    robot.Y_map = Y_map;
    robot.Np = Np;
    
%     figure;
%     hold on;
    
%     clock = 0;
    
    for i = 2:1:puntos
        
        estado_real(:, i) = [X(i) Y(i) theta(i)];
        estado_ideal(:, i) = modelo_directo(vl(i), vr(i), estado_ideal(:, i - 1), dt);            
        
        robot.estado = estado_real(:, i);
        robot.vel = [vr(i) vl(i)];
        
        %z_ideal = ultrasonido(robot, 1);
        z = [medida_1(i) medida_2(i) medida_3(i)]';
        robot.meas = z;
        
        [estado_filtrado(:, i), particulas, w_k] = filtro_particulas(particulas, w_k, robot);
               
%         plot_rob(estado_ideal(:, i));
%         plot(estado_ideal(1, 1:i), estado_ideal(2, 1:i), '-')
%         particulas_view(particulas);
%         xlabel('X [mm]');
%         ylabel('Y [mm]');
%         title('Mapa');
%         xlim([0 4060]);
%         ylim([0 5175]);
% 
%         pause(1e-6);
%         
%         if i < puntos-1
%             clf;
%         end
    end
%     plot(estado_filtrado(1, :), estado_filtrado(2, :), '-')

    %hold off;
    
    figure;
    plot(estado_filtrado(1, :), estado_filtrado(2, :), 'b-')
    hold on;
    plot(estado_real(1, :), estado_real(2, :), 'r-')
    plot(estado_ideal(1, :), estado_ideal(2, :), 'g-')
    hold off;
    xlabel('X [mm]');
    ylabel('Y [mm]');
    legend('Estado estimado', 'Estado real', 'Estado ideal');
    
    figure;
    plot(estado_filtrado(3, :), 'b-'); hold on;
    plot(estado_real(3, :), 'r-'); 
    plot(estado_ideal(3, :), 'g-'); hold off;
    xlabel('tiempo [s]');
    ylabel('angulo [rad]');
    legend('Estado estimado', 'Estado real', 'Estado ideal');
    
    figure;
    plot(estado_filtrado(1, :), 'b-'); hold on;
    plot(estado_real(1, :), 'r-'); 
    plot(estado_ideal(1, :), 'g-'); hold off;
    xlabel('tiempo [s]');
    ylabel('X [mm]');
    legend('Estado estimado', 'Estado real', 'Estado ideal');
    
    figure;
    plot(estado_filtrado(2, :), 'b-'); hold on;
    plot(estado_real(2, :), 'r-'); 
    plot(estado_ideal(2, :), 'g-'); hold off;
    xlabel('tiempo [s]');
    ylabel('Y [mm]');
    legend('Estado estimado', 'Estado real', 'Estado ideal');
end





